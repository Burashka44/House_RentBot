# Architecture Overview: Telegram Bot + Web Interface

## –ï–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Telegram –±–æ—Ç –∏ –≤–µ–±-—Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞—é—Ç **—Å –æ–¥–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**.

---

## Shared Database

### PostgreSQL Database
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      PostgreSQL Database            ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚Ä¢ 20 —Ç–∞–±–ª–∏—Ü                        ‚îÇ
‚îÇ  ‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ         ‚îÇ
‚îÇ  ‚Ä¢ –ï–¥–∏–Ω–∞—è —Å—Ö–µ–º–∞                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                    ‚ñ≤
         ‚îÇ                    ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Telegram‚îÇ         ‚îÇ   Web   ‚îÇ
    ‚îÇ   Bot   ‚îÇ         ‚îÇ  Site   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–ª—è –æ–±–æ–∏—Ö)

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–ª—å—Ü–∞–º–∏
**Telegram Bot:**
- `/tenants` - —Å–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –∂–∏–ª—å—Ü–∞ —á–µ—Ä–µ–∑ FSM
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å

**Web Site:**
- `GET /api/tenants` - —Å–ø–∏—Å–æ–∫
- `POST /api/tenants` - —Å–æ–∑–¥–∞—Ç—å
- `PUT /api/tenants/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- `DELETE /api/tenants/:id` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞–º–∏
**Telegram Bot:**
- `/objects` - —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π

**Web Site:**
- `GET /api/objects` - —Å–ø–∏—Å–æ–∫
- `POST /api/objects` - —Å–æ–∑–¥–∞—Ç—å
- `GET /api/objects/:id` - –¥–µ—Ç–∞–ª–∏

### 3. –ü–ª–∞—Ç–µ–∂–∏
**Telegram Bot:**
- –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞ (—Ñ–æ—Ç–æ)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
- –†—É—á–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞ (–∞–¥–º–∏–Ω)

**Web Site:**
- `POST /api/payments` - —Å–æ–∑–¥–∞—Ç—å
- `GET /api/payments` - –∏—Å—Ç–æ—Ä–∏—è
- `POST /api/charges/:id/mark-paid` - –æ—Ç–º–µ—Ç–∏—Ç—å

### 4. –û—Ç—á—ë—Ç—ã
**Telegram Bot:**
- üìä –î–æ–ª–∂–Ω–∏–∫–∏
- üìà –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç
- üí∞ –ë–∞–ª–∞–Ω—Å

**Web Site:**
- `GET /api/reports/debtors`
- `GET /api/reports/monthly`
- `GET /api/reports/balance`

### 5. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
**Telegram Bot:**
- –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –º–µ–Ω—é

**Web Site:**
- `GET /api/analytics/overview` - dashboard
- `GET /api/analytics/revenue` - –≥—Ä–∞—Ñ–∏–∫–∏
- `GET /api/analytics/occupancy` - –∑–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å

### 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
**Telegram Bot:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ OWNER)

**Web Site:**
- `GET /api/bots` - —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤
- `POST /api/bots` - –¥–æ–±–∞–≤–∏—Ç—å
- `PUT /api/bots/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å

---

## Data Flow

### –ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∂–∏–ª—å—Ü–∞

**–ß–µ—Ä–µ–∑ Telegram:**
```
1. –ê–¥–º–∏–Ω ‚Üí /add_tenant
2. Bot ‚Üí FSM (–∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö)
3. –ê–¥–º–∏–Ω ‚Üí –≤–≤–æ–¥–∏—Ç –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω
4. Bot ‚Üí INSERT INTO tenants
5. DB ‚Üí tenants table updated
```

**–ß–µ—Ä–µ–∑ Web:**
```
1. –ê–¥–º–∏–Ω ‚Üí POST /api/tenants
2. Web API ‚Üí INSERT INTO tenants
3. DB ‚Üí tenants table updated
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `tenants`

---

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### Real-time Updates
```
Telegram Bot –¥–æ–±–∞–≤–∏–ª –∂–∏–ª—å—Ü–∞
         ‚Üì
    PostgreSQL DB
         ‚Üì
Web Site –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É
```

**–ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:**
- –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ë–î
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
- –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. **–í—ã–±–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞** - Telegram –∏–ª–∏ Web
2. **–ï–¥–∏–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - –Ω–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ

### ‚úÖ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
1. **–û–¥–Ω–∞ –ë–î** - –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
2. **–û–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
3. **–ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Telegram Bot
```python
# bot/services/tenant_service.py
async def create_tenant(session, data):
    tenant = Tenant(**data)
    session.add(tenant)
    await session.commit()
    return tenant
```

### Web API
```python
# web/api/tenants.py
@app.post("/api/tenants")
async def create_tenant(data: TenantCreate):
    async with get_session() as session:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–¢ –ñ–ï —Å–µ—Ä–≤–∏—Å!
        from bot.services.tenant_service import create_tenant
        return await create_tenant(session, data)
```

**–û–±—â–∏–π –∫–æ–¥:** `bot/services/` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–æ–∏–º–∏!

---

## Database Access

### Telegram Bot
```python
# bot/database/core.py
DATABASE_URL = "postgresql://..."
engine = create_async_engine(DATABASE_URL)
```

### Web Site
```python
# web/database.py
from bot.database.core import engine  # –¢–ê –ñ–ï –ë–î!
```

---

## Deployment

### Option 1: –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```yaml
# docker-compose.yml
services:
  postgres:
    image: postgres:15
  
  telegram-bot:
    build: .
    depends_on: [postgres]
  
  web-api:
    build: ./web
    depends_on: [postgres]
```

### Option 2: –û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```yaml
services:
  postgres:
    image: postgres:15
  
  app:
    build: .
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏ –±–æ—Ç–∞, –∏ web API
```

---

## API Parity

| –§—É–Ω–∫—Ü–∏—è | Telegram Bot | Web API | –ë–î |
|---------|-------------|---------|-----|
| –°–æ–∑–¥–∞—Ç—å –∂–∏–ª—å—Ü–∞ | ‚úÖ FSM | ‚úÖ POST /api/tenants | `tenants` |
| –°–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤ | ‚úÖ /tenants | ‚úÖ GET /api/tenants | `tenants` |
| –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂ | ‚úÖ –§–æ—Ç–æ —á–µ–∫–∞ | ‚úÖ POST /api/payments | `payments` |
| –û—Ç—á—ë—Ç –¥–æ–ª–∂–Ω–∏–∫–æ–≤ | ‚úÖ üìã –î–æ–ª–∂–Ω–∏–∫–∏ | ‚úÖ GET /api/reports/debtors | `rent_charges` |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚úÖ –ë–∞–∑–æ–≤–∞—è | ‚úÖ GET /api/analytics | –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã |

**100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å!**

---

## Security

### –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞:

**Telegram Bot:**
```python
@router.callback_query(AdminFilter())
async def admin_menu(...):
    # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã
```

**Web API:**
```python
@app.get("/api/admin/...")
async def admin_endpoint(user: User = Depends(get_current_user)):
    if user.role not in ['owner', 'admin']:
        raise HTTPException(403)
```

---

## –î–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∞–π—Ç–∞

### –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
1. **`API_DOCUMENTATION.md`** - –≤—Å–µ endpoints
2. **`DATABASE_SCHEMA.md`** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
3. **`bot/services/`** - –≥–æ—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
4. **`bot/database/models.py`** - –º–æ–¥–µ–ª–∏ SQLAlchemy

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞:
```
–ò—Å–ø–æ–ª—å–∑—É—è API_DOCUMENTATION.md –∏ DATABASE_SCHEMA.md,
—Å–æ–∑–¥–∞–π –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Next.js, –∫–æ—Ç–æ—Ä–æ–µ:
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ç–æ–π –∂–µ PostgreSQL –ë–î
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —Ç–∞–±–ª–∏—Ü—ã (tenants, objects, payments)
3. –†–µ–∞–ª–∏–∑—É–µ—Ç —Ç–µ –∂–µ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –∏ Telegram –±–æ—Ç
4. –ò–º–µ–µ—Ç admin dashboard —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
5. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏ —á–µ—Ä–µ–∑ /api/bots
```

---

## –ò—Ç–æ–≥

‚úÖ **–û–¥–Ω–∞ –ë–î** - PostgreSQL  
‚úÖ **–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - Telegram = Web  
‚úÖ **–û–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞  
‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - real-time  
‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** - –≤—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –µ—Å—Ç—å  

**Telegram –±–æ—Ç –∏ –≤–µ–±-—Å–∞–π—Ç - –¥–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ!** üöÄ
